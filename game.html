<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web FPS Game - Play</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #gameOver {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 32px; background: rgba(0,0,0,0.7); color: white; padding: 20px;
      display: none; text-align: center;
    }
  </style>
</head>
<body>
  <div id="gameOver">
    <p>Game Over!</p>
    <button onclick="location.reload()">Restart</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
    let scene, camera, renderer, controls, playerHealth = 100;
    let bullets = [], enemies = [], enemyBullets = [];

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      controls = new THREE.PointerLockControls(camera, document.body);
      document.body.addEventListener('click', () => controls.lock());

      scene.add(controls.getObject());

      let floorGeo = new THREE.PlaneGeometry(500, 500);
      let floorMat = new THREE.MeshBasicMaterial({ color: 0x555555, side: THREE.DoubleSide });
      let floor = new THREE.Mesh(floorGeo, floorMat);
      floor.rotation.x = Math.PI / 2;
      scene.add(floor);

      spawnEnemies();

      document.addEventListener('keydown', onKeyDown);
    }

    function spawnEnemies() {
      for (let i = 0; i < 5; i++) {
        let enemyGeo = new THREE.BoxGeometry(2, 2, 2);
        let enemyMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        let enemy = new THREE.Mesh(enemyGeo, enemyMat);
        enemy.position.set(Math.random() * 100 - 50, 1, Math.random() * 100 - 50);
        enemy.health = 50;
        scene.add(enemy);
        enemies.push(enemy);
      }
    }

    function onKeyDown(e) {
      if (e.code === 'Space') shoot();
    }

    function shoot() {
      let bulletGeo = new THREE.SphereGeometry(0.1, 8, 8);
      let bulletMat = new THREE.MeshBasicMaterial({ color: 0xffff00 });
      let bullet = new THREE.Mesh(bulletGeo, bulletMat);
      bullet.position.copy(camera.position);
      bullet.velocity = new THREE.Vector3();
      camera.getWorldDirection(bullet.velocity);
      bullet.velocity.multiplyScalar(2);
      bullets.push(bullet);
      scene.add(bullet);
    }

    function animate() {
      requestAnimationFrame(animate);

      bullets.forEach((b, i) => {
        b.position.add(b.velocity);
        enemies.forEach((enemy, ei) => {
          if (b.position.distanceTo(enemy.position) < 1) {
            enemy.health -= 20;
            if (enemy.health <= 0) {
              scene.remove(enemy);
              enemies.splice(ei, 1);
            }
            scene.remove(b);
            bullets.splice(i, 1);
          }
        });
      });

      enemies.forEach(enemy => {
        let dir = new THREE.Vector3();
        dir.subVectors(controls.getObject().position, enemy.position).normalize().multiplyScalar(0.03);
        enemy.position.add(dir);

        if (Math.random() < 0.01) shootEnemyBullet(enemy);
      });

      enemyBullets.forEach((b, i) => {
        b.position.add(b.velocity);
        if (b.position.distanceTo(controls.getObject().position) < 1) {
          playerHealth -= 10;
          scene.remove(b);
          enemyBullets.splice(i, 1);
          if (playerHealth <= 0) document.getElementById('gameOver').style.display = 'block';
        }
      });

      renderer.render(scene, camera);
    }

    function shootEnemyBullet(enemy) {
      let bulletGeo = new THREE.SphereGeometry(0.1, 8, 8);
      let bulletMat = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
      let bullet = new THREE.Mesh(bulletGeo, bulletMat);
      bullet.position.copy(enemy.position);
      bullet.velocity = new THREE.Vector3();
      bullet.velocity.subVectors(controls.getObject().position, enemy.position).normalize().multiplyScalar(0.1);
      enemyBullets.push(bullet);
      scene.add(bullet);
    }

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
